<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen AI Multi-Zone v14</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --p: #6c5ce7; --s: #00cec9; --d: #ff7675; --f: #2ed573; --bg: #f8f9fa; --card: #ffffff; --txt: #2d3436; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--txt); margin: 0; padding: 15px; padding-bottom: 100px; }
        .card { background: var(--card); padding: 15px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .btn { border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; width: 100%; transition: 0.2s; font-size: 14px; }
        
        .tab-buttons { display: flex; margin-bottom: 15px; }
        .tab-buttons button { flex: 1; padding: 10px; background: #eee; border: none; cursor: pointer; border-radius: 10px 10px 0 0; }
        .tab-buttons button.active { background: var(--card); border-bottom: 3px solid var(--p); }

        #substitutionResult { background: #fff3e0; padding: 10px; border-radius: 10px; margin-top: 10px; font-size: 12px; display: none; }

        .item { display: flex; align-items: center; padding: 12px; background: white; border-radius: 15px; margin-bottom: 8px; border-left: 5px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    </style>
</head>
<body>

<div class="card">
    <b>Zones de Stockage</b>
    <div class="tab-buttons">
        <button id="tabFrigo" class="active" onclick="setZone('Frigo')">üßä Frigo</button>
        <button id="tabCongelo" onclick="setZone('Congelo')">‚ùÑÔ∏è Cong√©lo</button>
        <button id="tabGardeManger" onclick="setZone('GardeManger')"> pantry Garde-Manger</button>
    </div>

    <input type="text" id="itemName" placeholder="Nom de l'aliment">
    <button class="btn" style="background:var(--s); color:white; margin-top:5px;" onclick="substituteItem()">ü§ñ Substituer</button>
    <div id="substitutionResult"></div>

    <input type="date" id="itemDate" style="margin-top:10px;">
    <button class="btn" style="background:var(--p); color:white; margin-top:10px;" onclick="addItem()">üíæ Ajouter au Stock</button>
    
    <button class="btn" style="background:#ffc107; color:#333; margin-top:10px;" onclick="startGroupScan()">üì∏ Scan de Groupe</button>
    <canvas id="groupScanCanvas" style="display:none; width:100%; border:1px solid #ddd; margin-top:10px;"></canvas>
    <input type="file" id="groupScanInput" hidden accept="image/*" onchange="processGroupScan(event)">
</div>

<div id="inventoryList"></div>

<script>
    let stock = JSON.parse(localStorage.getItem('v14Stock')) || [];
    let currentZone = 'Frigo';

    // --- 2. GESTION MULTI-ZONES ---
    function setZone(zone) {
        currentZone = zone;
        document.querySelectorAll('.tab-buttons button').forEach(btn => btn.classList.remove('active'));
        document.getElementById('tab' + zone).classList.add('active');
        renderInventory();
    }

    function addItem() {
        const name = document.getElementById('itemName').value;
        const date = document.getElementById('itemDate').value;
        if(name && date) {
            stock.push({ name, date, zone: currentZone, id: Date.now() });
            localStorage.setItem('v14Stock', JSON.stringify(stock));
            document.getElementById('itemName').value = '';
            document.getElementById('itemDate').value = '';
            renderInventory();
        }
    }

    function renderInventory() {
        const list = document.getElementById('inventoryList');
        list.innerHTML = '';
        stock.filter(item => item.zone === currentZone).sort((a,b) => new Date(a.date) - new Date(b.date)).forEach(item => {
            const daysLeft = Math.ceil((new Date(item.date) - new Date()) / (1000 * 60 * 60 * 24));
            const color = daysLeft < 0 ? '#ff7675' : (daysLeft < 3 ? '#ffa502' : '#2ed573');
            list.innerHTML += `
                <div class="item" style="border-left-color:${color}">
                    <div style="flex-grow:1;"><b>${item.name}</b><br><small>DLC: ${item.date} (${daysLeft < 0 ? 'P√©rim√©' : 'J-' + daysLeft})</small></div>
                    <button onclick="removeItem(${item.id})" style="background:none; border:none; font-size:20px;">‚úÖ</button>
                </div>`;
        });
    }

    function removeItem(id) {
        stock = stock.filter(item => item.id !== id);
        localStorage.setItem('v14Stock', JSON.stringify(stock));
        renderInventory();
    }

    // --- 1. ASSISTANT DE SUBSTITUTION (IA SIMUL√âE) ---
    function substituteItem() {
        const item = document.getElementById('itemName').value.toLowerCase();
        const resultDiv = document.getElementById('substitutionResult');
        let suggestion = '';

        if (item.includes('cr√®me') || item.includes('lait')) {
            suggestion = "Si tu n'as pas de cr√®me ou de lait, le yaourt nature ou la pur√©e de l√©gumes peuvent servir d'√©paississant.";
        } else if (item.includes('oeuf')) {
            suggestion = "Pas d'≈ìufs ? Essaye une banane √©cras√©e (en p√¢tisserie) ou des graines de lin moulues avec de l'eau.";
        } else if (item.includes('farine')) {
            suggestion = "Manque de farine ? La ma√Øzena ou la poudre d'amande sont de bonnes alternatives pour lier.";
        } else {
            suggestion = "D√©sol√©, je n'ai pas de suggestion pour cet ingr√©dient. Essaie un autre nom !";
        }
        resultDiv.innerHTML = `<b>Suggestion AI :</b> ${suggestion}`;
        resultDiv.style.display = 'block';
    }

    // --- 3. SCAN DE GROUPE (SIMUL√â OCR) ---
    function startGroupScan() {
        document.getElementById('groupScanInput').click();
    }

    async function processGroupScan(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = async (e) => {
            const img = new Image();
            img.onload = async () => {
                const canvas = document.createElement('canvas');
                canvas.width = img.width;
                canvas.height = img.height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0);

                // Simulation de reconnaissance OCR multi-objets
                alert("Analyse de la photo... (Simulation d'OCR)");
                const detectedItems = ["Poulet", "Carottes", "Yaourts"]; // Exemple de d√©tection
                
                let detectedText = "";
                // Pour une vraie impl√©mentation, on ferait √ßa:
                // const worker = await Tesseract.createWorker('fra');
                // const { data: { text } } = await worker.recognize(canvas);
                // await worker.terminate();
                // detectedText = text;

                // On extrait les noms simul√©s
                detectedItems.forEach(item => {
                    stock.push({ name: item, date: "2026-03-10", zone: currentZone, id: Date.now() + Math.random() });
                });
                localStorage.setItem('v14Stock', JSON.stringify(stock));
                renderInventory();
                alert(`Produits d√©tect√©s et ajout√©s : ${detectedItems.join(', ')}`);
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }
    
    renderInventory();
    setZone('Frigo'); // Zone par d√©faut
</script>
</body>
</html>
