<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitchen Master Pro v10</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
    <style>
        :root { --bg: #f0f2f5; --card: white; --text: #333; --primary: #6c5ce7; --urgent: #ff7675; --warning: #ffa502; --fresh: #2ed573; }
        .dark-mode { --bg: #1a1a1a; --card: #2d2d2d; --text: #eee; --primary: #a29bfe; }
        
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); transition: 0.3s; margin: 0; padding: 10px; }
        .container { max-width: 450px; margin: auto; background: var(--card); padding: 15px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        #moneySaved { background: var(--fresh); color: white; padding: 5px 12px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        
        #priorityAlert { display: none; background: var(--urgent); color: white; padding: 10px; border-radius: 12px; margin-bottom: 15px; font-weight: bold; }

        .btn { width: 100%; padding: 12px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin: 5px 0; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: white; }
        
        input, select { width: 100%; padding: 12px; margin: 5px 0; border: 2px solid #ddd; border-radius: 10px; background: var(--card); color: var(--text); box-sizing: border-box; }
        
        .cat-tag { font-size: 10px; font-weight: bold; text-transform: uppercase; padding: 2px 8px; border-radius: 10px; background: #eee; color: #666; display: inline-block; margin-top: 5px; }
        
        .category-group { text-align: left; margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        .category-title { font-size: 14px; font-weight: bold; color: var(--primary); margin-bottom: 10px; display: flex; align-items: center; gap: 5px; }

        .item { display: flex; align-items: center; padding: 12px; margin-bottom: 8px; border-radius: 12px; background: var(--card); border-left: 6px solid #ccc; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .item-icon { font-size: 24px; margin-right: 12px; }
        .item-info { flex-grow: 1; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <button onclick="toggleDarkMode()" class="btn" style="width: 45px; background: #34495e;">üåì</button>
        <div id="moneySaved">üí∞ ECO : 0.00 ‚Ç¨</div>
    </div>

    <div id="priorityAlert">‚ö†Ô∏è URGENCES : √Ä CONSOMMER !</div>

    <div id="reader" style="width:100%; border-radius:15px; overflow:hidden; background:#000;"></div>
    
    <input type="text" id="foodName" placeholder="Nom de l'aliment">
    
    <select id="foodCategory">
        <option value="Autre">üì¶ Autre</option>
        <option value="Viande">ü•© Viande / Poisson</option>
        <option value="L√©gumes">ü•¶ Fruits & L√©gumes</option>
        <option value="Laitier">üßÄ Produits Laitiers</option>
        <option value="F√©culents">üçù F√©culents / Pain</option>
        <option value="Boissons">ü•§ Boissons</option>
        <option value="Surgel√©s">‚ùÑÔ∏è Surgel√©s</option>
    </select>

    <div style="background: #f9f9f9; padding: 10px; border-radius: 15px; border: 1px dashed var(--primary);">
        <button class="btn btn-primary" onclick="readDateWithIA()">üîç SCANNER DATE IA</button>
        <input type="date" id="expiryDate">
    </div>

    <button class="btn btn-primary" style="background:#1877f2; margin-top:10px;" onclick="addToStock()">üíæ AJOUTER AU STOCK</button>

    <input type="text" id="searchInput" placeholder="üîç Rechercher un produit..." oninput="render()" style="margin-top:20px;">

    <div id="inventory"></div>
</div>

<script>
    const categories = {
        "Viande": "ü•©", "L√©gumes": "ü•¶", "Laitier": "üßÄ", 
        "F√©culents": "üçù", "Boissons": "ü•§", "Surgel√©s": "‚ùÑÔ∏è", "Autre": "üì¶"
    };

    let inventory = JSON.parse(localStorage.getItem('foodStock')) || [];
    let savings = parseFloat(localStorage.getItem('savings')) || 0;
    let isDark = localStorage.getItem('darkMode') === 'true';

    if(isDark) document.body.classList.add('dark-mode');

    function addToStock() {
        const name = document.getElementById('foodName').value;
        const date = document.getElementById('expiryDate').value;
        const cat = document.getElementById('foodCategory').value;
        if(!name || !date) return alert("Remplis le nom et la date !");

        inventory.push({ name, date, cat });
        save(); render();
        // Reset
        document.getElementById('foodName').value = "";
    }

    function toggleDarkMode() {
        isDark = !isDark;
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', isDark);
    }

    function consume(i) {
        let price = (Math.random() * 3 + 1).toFixed(2);
        savings += parseFloat(price);
        inventory.splice(i, 1);
        save(); render();
    }

    function save() {
        localStorage.setItem('foodStock', JSON.stringify(inventory));
        localStorage.setItem('savings', savings);
    }

    function render() {
        const invDiv = document.getElementById('inventory');
        const search = document.getElementById('searchInput').value.toLowerCase();
        document.getElementById('moneySaved').innerText = `üí∞ √âCO : ${savings.toFixed(2)} ‚Ç¨`;
        invDiv.innerHTML = "";

        // Grouper par cat√©gorie
        const groups = {};
        inventory.forEach((it, index) => {
            if(it.name.toLowerCase().includes(search)) {
                if(!groups[it.cat]) groups[it.cat] = [];
                groups[it.cat].push({...it, originalIndex: index});
            }
        });

        for(let cat in groups) {
            let section = document.createElement('div');
            section.className = 'category-group';
            section.innerHTML = `<div class="category-title">${categories[cat]} ${cat}</div>`;
            
            groups[cat].forEach(it => {
                let diff = (new Date(it.date) - new Date()) / 86400000;
                let cls = diff < 0 ? 'urgent' : (diff < 2 ? 'warning' : 'fresh');
                
                section.innerHTML += `
                    <div class="item" style="border-left-color: var(--${cls})">
                        <div class="item-icon">${categories[cat]}</div>
                        <div class="item-info">
                            <b>${it.name}</b><br><small>DLC: ${it.date}</small>
                        </div>
                        <button onclick="consume(${it.originalIndex})" style="border:none; background:none; font-size:22px;">‚úÖ</button>
                    </div>`;
            });
            invDiv.appendChild(section);
        }
    }

    // Le scanner et l'IA (Tesseract) restent les m√™mes
    function readDateWithIA() {
        // ... (Code IA des versions pr√©c√©dentes) ...
        alert("Analyse de la date en cours...");
    }

    render();
</script>
</body>
</html>
